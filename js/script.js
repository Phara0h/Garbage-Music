function LoginClick(){TINY.box.show({html:login,animate:true,close:false,fixed:false});$(document).on("click","#loginb",LoginUser)}function LogoutClick(){$.ajax({type:"POST",url:"./php/logout.php"}).done(function(e){$("#titlescreen").fadeIn(400);location.reload()})}function RegClick(){var e="";e+='<input type="text" placeholder="Email" name="uName" id="uNameF" size="30" /><br>';e+='<input type="password" placeholder="Password" name="passF" id="passF" size="30" /><br>';e+='<input type="password" placeholder="Confirm Password" name="passcF" id="passcF" size="30" /><br>';e+='<br><div id="LoginError"></div><br>';e+='<div id="bottomlogin"><div id="regpass"> <br><br><br></div>';e+='<a class="button" id="regb">Register</a>';e+='<div id="preload"></div></div>';TINY.box.show({html:e,animate:true,close:false,fixed:false});$(document).on("click","#regb",RegUser)}function AddTrackClick(e){var t=e.target.id.split("-")[0];var n="";n+='<input type="text" placeholder="Track URL" name="trackurl" id="trackurlF" size="30" /><br>';n+='<a class="button" id="trackb-'+t+'">Submit</a>';console.log(t);TINY.box.show({html:n,animate:true,close:false,fixed:false});$(document).on("click","#trackb-"+t,AddTrackUrl)}function InitSearch(){console.log(artist_T);$("#smenu .typeahead").typeahead([{name:"Artist",local:artist_T,header:'<h3 class="tname">Artist</h3>'},{name:"Album",local:album_T,header:'<h3 class="tname">Album</h3>'},{name:"Genre",local:genre_T,header:'<h3 class="tname">Genre</h3>'},{name:"Track",local:track_T,header:'<h3 class="tname">Track</h3>'}]).on("keyup",function(e){Search($(".tt-query").val())}).on("typeahead:selected",function(e){console.log(e);Search(e.target.value)})}function Search(e){if(e==""||e==" "){$(".album").show()}else{$(".album:not(:contains('"+e+"'))").fadeOut();$(".album:contains('"+e+"')").show()}}function LoginUser(){$("#loginb").hide();$("#regpass").hide();$("#preload").empty();$("#preload").html('<div class="progress progress-success progress-striped active"><div class="bar" style="width: 100%;"></div></div>');$("#preload").show();$.ajax({type:"POST",url:"./php/login.php",data:{username:$("#userF").val(),pass:$("#passF").val()}}).done(function(e){$("#regpass").show();if(e==1){parent.TINY.box.hide();location.reload()}else if(e==2){$("#bottomlogin").hide();$("#preload").hide();$("#LoginError").empty().html("Account not verified! Please check your email for a verification code.").hide();$("#LoginError").fadeIn(400);$("#LoginError").delay(1e3).fadeOut(400,function(){$("#loginb").show();$("#bottomlogin").show()})}else{$("#bottomlogin").hide();$("#preload").hide();$("#LoginError").empty().html("Invalid username or password.").hide();$("#LoginError").fadeIn(400);$("#LoginError").delay(1e3).fadeOut(400,function(){$("#loginb").show();$("#bottomlogin").show()})}})}function RegUser(){var e=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var t=$("#uNameF").val();$("#regb").hide();$("#regpass").hide();$("#preload").empty();$("#preload").html('<div class="progress progress-success progress-striped active"><div class="bar" style="width: 100%;"></div></div>');$("#preload").show();console.log(e.test(t));if(!e.test(t)){$("#bottomlogin").hide();$("#preload").hide();$("#LoginError").empty().html("Input a vaild email address").hide();$("#LoginError").fadeIn(400);$("#LoginError").delay(1e3).fadeOut(400,function(){$("#regb").show();$("#bottomlogin").show()})}else if($("#passF").val()!=$("#passcF").val()){$("#bottomlogin").hide();$("#preload").hide();$("#LoginError").empty().html("Your passwords do not match!").hide();$("#LoginError").fadeIn(400);$("#LoginError").delay(1e3).fadeOut(400,function(){$("#regb").show();$("#bottomlogin").show()})}else if($("#passF").val().length<4){$("#bottomlogin").hide();$("#preload").hide();$("#LoginError").empty().html("Your password must be larger than 3 characters").hide();$("#LoginError").fadeIn(400);$("#LoginError").delay(1e3).fadeOut(400,function(){$("#regb").show();$("#bottomlogin").show()})}else{$.ajax({type:"POST",url:"./php/newuser.php",data:{username:t,pass:$("#passF").val()}}).done(function(e){console.log(e);if(e!=1){TINY.box.show({html:"You are now registered!",animate:true,close:false,fixed:false,boxid:"success",autohide:3})}else{$("#bottomlogin").hide();$("#preload").hide();$("#LoginError").empty().html("Error: Either this user all ready exists or there was another unknown error.").hide();$("#LoginError").fadeIn(400);$("#LoginError").delay(1e3).fadeOut(400,function(){$("#regb").show();$("#bottomlogin").show()})}})}}function ShowMusicList(){$.ajax({type:"POST",url:"./php/music.php",data:{job:"getmusic"}}).done(function(e){$("#music").text("");var t=JSON.parse(e);t.forEach(function(e){var t="";e.Artists.forEach(function(e){t+=e+",";artist_T.push(e)});t=t.substring(0,t.length-1);e.Tracks.forEach(function(n){if(e.CoverArt.indexOf("http")!==-1){var r='<div class ="album"><p><img src="'+e.CoverArt+'" height="126" width="126"></p><p>'}else{var r='<div class ="album"><p><img src="http:\\\\'+e.CoverArt+'" height="126" width="126"></p><p>'}track_T.push(n.TrackName);album_T.push(e.AlbumName);genre_T.push(e.GenreName);r+=" Album: "+e.AlbumName+"<br> Artist/s: "+t+"<br> Track: "+n.TrackName+"<br> Duration: "+n.TrackDuration+"s"+"<br> Genre: "+e.GenreName+"<br> Release Date: "+e.ReleaseDate+"<br> Album Rating: "+e.Rating+"</p>";r+='<div class ="albumB">';if(n.TrackURL!=null){var i=n.TrackURL+" ";if(i.indexOf("http")!==-1){r+='<a href="'+i+'" target="_blank"><i class="icon-play icon-white"></i></a>'}else{r+='<a href="http:\\\\'+i+'" target="_blank"><i class="icon-play icon-white"></i></a>'}}else{r+='<a ><i id="'+n.TrackID+"-"+e.AlbumID+'"class="icon-plus icon-white"></i></a>'}r+='<div id="'+n.TrackID+'"></div> '+"</div>";r+="</div>"+" ";if(n.TrackRating==0)n.TrackRating=1;$("#music").append(r);$("#"+n.TrackID).raty({precision:true,score:n.TrackRating/2,click:function(e,t){RateAlbum($(this).attr("id"),e*2)}})})});artist_T=_.uniq(artist_T,false);artist_T=_.compact(artist_T);genre_T=_.uniq(genre_T,false);genre_T=_.compact(genre_T);album_T=_.uniq(album_T,false);track_T=_.uniq(track_T,false);$("#can #music .albumB a .icon-plus").click(function(e){AddTrackClick(e)});InitSearch()})}function ShowRecommend(){$.ajax({type:"POST",url:"./php/music.php",data:{job:"getrecommend"}}).done(function(e){var t=JSON.parse(e);var n="<br> Track Recommendations: ";t.forEach(function(e){n+=" "+e+","});n=n.slice(0,-1);$("#node").html(n)})}function RateAlbum(e,t){$.ajax({type:"POST",url:"./php/music.php",data:{job:"rate",id:e,rating:t,user:getCookie("sessionID")}}).done(function(t){console.log(t);if(parseInt(t)!=-1){$("#"+e).raty("score",t/2);TINY.box.show({html:"You have all ready rated this album, go rate some others instead.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else{TINY.box.show({html:"Your rating was submited!",animate:true,close:false,fixed:false,boxid:"success",autohide:3,closejs:function(){ShowMusicList()}})}})}function AddTrackUrl(e){var t=e.target.id.split("-")[1];var n=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;var r=$("#trackurlF").val();if(!n.test(r)){TINY.box.show({html:"You have entered a invalid URL. Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else{$.ajax({type:"POST",url:"./php/music.php",data:{job:"track",id:t,turl:r}}).done(function(e){TINY.box.show({html:"Your URL was submited!",animate:true,close:false,fixed:false,boxid:"success",autohide:3,closejs:function(){ShowMusicList()}})})}}function AddAlbum(){var e="";e+='<input type="text" placeholder="Album Name" name="aname" id="anameF"/><br>';e+='<input type="text" placeholder="CoverArt URL" name="acover" id="acoverF"/> <br>';e+="Release Date <br>";e+='<input type="date" name="adate" id="adateF" /> <br>';$.ajax({type:"POST",url:"./php/music.php",data:{job:"getgenres"}}).done(function(t){genres=JSON.parse(t);console.log(genres);e+="Albums Genre <br>";e+='<select id="agenre">';genres.forEach(function(t){e+="<option>"+t.GenreName+"</option>"});e+="</select> <br>";$.ajax({type:"POST",url:"./php/music.php",data:{job:"getartists"}}).done(function(t){artists=JSON.parse(t);console.log(artists);e+="Albums Artist <br>";e+='<select id="aartist">';artists.forEach(function(t){e+="<option>"+t.ArtistName+"</option>"});e+="</select> <br>";e+='<div id="LoginError"></div><br>';e+='<div id="bottomlogin"> ';e+='<a  class="button" id="addalbumb"/>Add </a>';e+='<div id="preload"></div></div> <br><br>';TINY.box.show({html:e,animate:true,close:false,fixed:false});$(document).on("click","#addalbumb",SubmitAddAlbum)})})}function SubmitAddAlbum(){var e=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;var t=$("#anameF").val();var n=$("#adateF").val();var r=$("#acoverF").val();var i=$("#agenre").val();var s=$("#aartist").val();console.log(t);console.log(n);console.log(r);console.log(i);console.log(s);if(!e.test(r)){TINY.box.show({html:"You have entered a invalid URL. Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else if(t==""||t==null){TINY.box.show({html:"You must have a album name! Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else{$.ajax({type:"POST",url:"./php/music.php",data:{job:"addAlbum",aName:t,aDate:n,aURL:r,aGenre:i,aArtist:s}}).done(function(e){console.log(e);TINY.box.show({html:"Your Album was submited!",animate:true,close:false,fixed:false,boxid:"success",autohide:3,closejs:function(){ShowMusicList()}})})}}function AddArtist(){var e="";e+='<input type="text" placeholder="Artist Name" name="artName" id="artNameF" size="30" /><br>';e+='<a class="button" id="addartist">Add</a>';TINY.box.show({html:e,animate:true,close:false,fixed:false});$(document).on("click","#addartist",AddArtistSubmit)}function AddArtistSubmit(){var e=$("#artNameF").val();if(!e){TINY.box.show({html:"You must have a artist name! Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else{$.ajax({type:"POST",url:"./php/music.php",data:{job:"addArtist",aName:e}}).done(function(e){TINY.box.show({html:"Your Artist was submited!",animate:true,close:false,fixed:false,boxid:"success",autohide:3,closejs:function(){ShowMusicList()}})})}}function AddGenre(){var e="";e+='<input type="text" placeholder="Genre Name" name="gName" id="gNameF" size="30" /><br>';e+='<a class="button" id="addgenre">Add</a>';TINY.box.show({html:e,animate:true,close:false,fixed:false});$(document).on("click","#addgenre",AddGenreSubmit)}function AddGenreSubmit(){var e=$("#gNameF").val();if(!e){TINY.box.show({html:"You must have a genre name! Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else{$.ajax({type:"POST",url:"./php/music.php",data:{job:"addGenre",gName:e}}).done(function(e){TINY.box.show({html:"Your Genre was submited!",animate:true,close:false,fixed:false,boxid:"success",autohide:3,closejs:function(){ShowMusicList()}})})}}function AddTrack(){var e="";e+='<input type=text placeholder="Track Name" name="tname" id="tnameF"/><br>';e+='<input type=number placeholder="Track Duration in Seconds" name="tdur" id="tdurF"/> <br>';e+='<input type=text placeholder="Tracks URL" name="turl" id="turlF"/> <br>';$.ajax({type:"POST",url:"./php/music.php",data:{job:"getalbums"}}).done(function(t){albums=JSON.parse(t);e+="Tracks Album <br>";e+='<select id="talbum">';albums.forEach(function(t){e+="<option>"+t.AlbumName+"</option>"});e+="</select> <br>";e+='<div id="LoginError"></div><br>';e+='<div id="bottomlogin"> ';e+='<a  class="button" id="addtrack"/>Add </a>';e+='<div id="preload"></div></div> <br><br>';TINY.box.show({html:e,animate:true,close:false,fixed:false});$(document).on("click","#addtrack",SubmitAddTrack)})}function SubmitAddTrack(){var e=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;var t=$("#tnameF").val();var n=$("#tdurF").val();var r=$("#turlF").val();var i=$("#talbum").val();console.log(t);console.log(n);console.log(r);console.log(i);if(r&&!e.test(r)){TINY.box.show({html:"You have entered a invalid URL. Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else if(!t){TINY.box.show({html:"You must have a track name! Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else if(!n&&n<0){TINY.box.show({html:"You must have a track duration in seconds! Please try again.",animate:true,close:false,fixed:false,boxid:"error",autohide:4})}else{if(!r){r==null;console.log(true)}$.ajax({type:"POST",url:"./php/music.php",data:{job:"addTrack",tName:t,tDur:n,tURL:r,tAlbum:i}}).done(function(e){console.log(e);TINY.box.show({html:"Your Track was submited!",animate:true,close:false,fixed:false,boxid:"success",autohide:3,closejs:function(){ShowMusicList()}})})}}function getCookie(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null}var login="";login+='<input type="text" placeholder="Username" name="user" id="userF" size="30" required pattern="^[a-zA-Z][a-zA-Z0-9-_.]{5,12}$"/><br>';login+='<input type="password" placeholder="Password" name="pass" id="passF" size="30" required pattern="(?=^.{5,12}$)((?=.*d)|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$"/> ';login+='<br><div id="LoginError"></div><br>';login+='<div id="bottomlogin"><div id="regpass"> <br><br><br></div>';login+='<a class="button" id="loginb">Login</a>';login+='<div id="preload"></div></div>';var artist_T=[];var album_T=[];var genre_T=[];var track_T=[];$(document).ready(function(){var e=getCookie("sessionID");var t=getCookie("sessionKey");if(e!=null&&t!=null){$.ajax({type:"POST",url:"./php/cookie.php"}).done(function(e){console.log(e);if(e!=0){$("#login").text("");$("#login").append("Logout");$("#login").attr("id","logout");$("#reg").hide();$("#titlescreen").fadeOut(400);$("#logout").click(function(e){LogoutClick()});ShowMusicList();ShowRecommend();if(e!=1){$("#botmenu").html(e)}$("#add_album").click(function(e){AddAlbum()});$("#add_artist").click(function(e){AddArtist()});$("#add_genre").click(function(e){AddGenre()});$("#add_track").click(function(e){AddTrack()})}else{$("#login").click(function(e){LoginClick()});$("#reg").click(function(e){RegClick()})}})}else{$("#login").click(function(e){LoginClick()});$("#reg").click(function(e){RegClick()})}$(".item").click(function(e){LogoutClick(e)})});$(window).resize(function(){})